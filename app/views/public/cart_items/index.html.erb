<div class="container">
  <div class="cart_item-header">
   <h4 class= "col-md-8">ショッピングカート</h4>
   <%= link_to "カートを空にする", all_destroy_cart_items_path, method: :delete, class: "btn btn-danger col-md-2" %>
  </div>

       <table class = "cart_items-table">
          <tr>
           <th>商品名</th>
           <th class="cart_items-table-th">単価(税込)</th>
           <th>数量</th>
           <th class="cart_items-table-total">小計</th>
           <th></th>
          </tr>

            <% total = 0 %>
            <!--合計金額totalの初期化-->

        <% if current_customer.cart_items.present? %>
           <% @cart_items.each do |cart_item| %>
            <tr>
              <td class= "cart_item-image">
                <%= image_tag cart_item.item.get_item_image(50,50) %>
                <%= cart_item.item.name %>
                <!--商品名-->
              </td>
              <td><%= ((cart_item.item.price*1.1).to_i).to_s(:delimited) %></td>
              <td>
                <%= form_with model: cart_item, url: cart_item_path(cart_item), local: true, method: :patch do |f| %>
                  <%= f.number_field :item_count, min: 1, max:10%>
                  <%= f.submit "変更",class: "btn btn-success" %>
                  <!--セレクトboxで数量変更-->
                <% end %>
              </td>
              <td class="cart_items-table-total">
                <% sub_total = (((cart_item.item.price*cart_item.item_count)*1.1).to_i).to_s(:delimited) %>
                <!--小計を計算する-->
                <%= sub_total %>
                <!--小計を表示-->
              </td>
              <td>
                <%= link_to "削除する", cart_item_path(cart_item.id, cart_item), method: :delete,class: "btn btn-danger" %>
              </td>
            <% total += cart_item.subtotal.to_i %>
              <!--アイテムごとに合計金額totalに反映 計算しておく-->
              </tr>
            <% end %>
       <% end %>


        </table>

        <div class= "cart_item-footer" >
          <%= link_to "買い物を続ける", items_path %>
           <p>合計金額
           <%= total.to_s(:delimited) %></p>

        </div>
          <%= link_to "情報入力に進む", new_order_path, class: "cart_item-footer-center"  %><br>


</div>